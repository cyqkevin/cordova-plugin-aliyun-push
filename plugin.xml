<?xml version='1.0' encoding='utf-8'?>
<plugin 
    xmlns:android="http://schemas.android.com/apk/res/android" id="cordova-plugin-alipush" version="1.0.0" 
    xmlns="http://apache.org/cordova/ns/plugins/1.0">
    <name>PushPlugin</name>
    <js-module name="PushPlugin" src="www/PushPlugin.js">
        <clobbers target="PushPlugin" />
    </js-module>
    <preference name="MIID" default="" />
    <preference name="MIKEY" default="" />
    <preference name="GCMSENDID" default=""/>
    <preference name="GCMAPPID" default=""/>
    <preference name="APP_KEY" />
    <preference name="APP_SECRET" />
    <dependency id="cordova-plugin-add-swift-support"/>
    <platform name="ios">
        <config-file parent="/*" target="config.xml">
            <feature name="AliPushPlugin">
                <param name="ios-package" value="AliPushPlugin" />
            </feature> 
        </config-file>
        <header-file src="src/ios/AliPush-Bridging-Header.h"/>
        <source-file src="src/ios/AliPushPlugin.swift"/>
        <source-file src="src/ios/AppDelegate+AliPush.swift"/>
        <resource-file src="src/ios/AliPushConfig.plist" />
        <!-- 依赖 -->
        <framework src="src/ios/libs/AlicloudUtils.framework" custom="true" />
        <framework src="src/ios/libs/CloudPushSDK.framework" custom="true" />
        <framework src="src/ios/libs/UTDID.framework" custom="true" />
        <framework src="src/ios/libs/UTMini.framework" custom="true" />
        <framework src="libz.tbd" framework="true"/>
        <framework src="libresolv.tbd" />
        <framework src="CoreTelephony.framework" />
        <framework src="SystemConfiguration.framework" />
        <framework src="UserNotifications.framework" />
        <framework src="libsqlite3.tbd" />
        <config-file target="*AliPushConfig.plist" parent="Appkey">
            <string>$APP_KEY</string>
        </config-file>
        <config-file target="*AliPushConfig.plist" parent="Appsecret">
            <string>$APP_SECRET</string>
        </config-file>
    </platform>
    <platform name="android">
        <config-file parent="/*" target="res/xml/config.xml">
            <feature name="AliPushPlugin">
                <param name="android-package" value="com.blanktrack.alipush.AliPushPlugin" />
            </feature>
        </config-file>
        <edit-config file="AndroidManifest.xml" target="/manifest/application" mode="merge">
            <application android:name="com.blanktrack.alipush.MyApplication"/>
        </edit-config>

        <config-file target="AndroidManifest.xml" parent="/manifest/application">
            <meta-data android:name="com.blanktrack.miid" android:value="\$MIID" />
            <meta-data android:name="com.blanktrack.mikey" android:value="\$MIKEY" />
            <meta-data android:name="com.blanktrack.gcmsendid" android:value="\$GCMSENDID" />
            <meta-data android:name="com.blanktrack.gcmappid" android:value="$GCMAPPID" />
            <meta-data android:name="com.alibaba.app.appkey" android:value="$APP_KEY" />
            <meta-data android:name="com.alibaba.app.appsecret" android:value="$APP_SECRET" />
            <receiver android:name="com.blanktrack.alipush.MyMessageReceiver" android:exported="false">
                <!-- 为保证receiver安全，建议设置不可导出，如需对其他应用开放可通过android：permission进行限制 -->
                <intent-filter>
                    <action android:name="com.alibaba.push2.action.NOTIFICATION_OPENED" />
                </intent-filter>
                <intent-filter>
                    <action android:name="com.alibaba.push2.action.NOTIFICATION_REMOVED" />
                </intent-filter>
                <intent-filter>
                    <action android:name="com.alibaba.sdk.android.push.RECEIVE" />
                </intent-filter>
            </receiver>
            <receiver android:name="com.google.firebase.iid.FirebaseInstanceIdReceiver" android:exported="true" android:permission="com.google.android.c2dm.permission.SEND">
                <intent-filter>
                    <action android:name="com.google.android.c2dm.intent.RECEIVE" />
                    <action android:name="com.google.android.c2dm.intent.REGISTRATION" />
                    <category android:name="com.taobao.taobao" />
                </intent-filter>
            </receiver>
            <receiver android:name="com.google.firebase.iid.FirebaseInstanceIdInternalReceiver" android:exported="false" />
            <service android:name="com.alibaba.sdk.android.push.AgooFirebaseInstanceIDService" android:exported="true">
                <intent-filter android:priority="-500">
                    <action android:name="com.google.firebase.INSTANCE_ID_EVENT" />
                </intent-filter>
            </service>
            <service android:name="com.alibaba.sdk.android.push.AgooFirebaseMessagingService" android:exported="true">
                <intent-filter android:priority="-500">
                    <action android:name="com.google.firebase.MESSAGING_EVENT" />
                </intent-filter>
            </service>
        </config-file>
        <framework src="push.gradle" custom="true" type="gradleReference" />
        <!--<framework src="com.aliyun.ams:alicloud-android-push:3.0.11@aar" />-->
        <!--<framework src="com.aliyun.ams:alicloud-android-utdid:1.1.5.3" />-->
        <!--<framework src="com.aliyun.ams:alicloud-android-ut:5.1.0" />-->
        <!--<framework src="com.aliyun.ams:alicloud-android-third-push:3.0.3@aar" />-->
        <source-file src="src/android/com/blanktrack/alipush/PushPlugin.java" target-dir="src/com/blanktrack/alipush/" />
        <source-file src="src/android/com/blanktrack/alipush/MyMessageReceiver.java" target-dir="src/com/blanktrack/alipush/" />
        <source-file src="src/android/com/blanktrack/alipush/MyApplication.java" target-dir="src/com/blanktrack/alipush/" />
    </platform>
</plugin>